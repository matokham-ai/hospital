<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Performance Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .test-card {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            background: #f8fafc;
        }
        .test-card.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        .results {
            background: #f1f5f9;
            border-radius: 4px;
            padding: 12px;
            margin-top: 12px;
            font-family: monospace;
            font-size: 14px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }
        .metric.good { color: #059669; }
        .metric.warning { color: #d97706; }
        .metric.bad { color: #dc2626; }
        .progress {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-bar {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Admin System Performance Tests</h1>
        <p>This tool tests the performance of admin components with various dataset sizes.</p>
        
        <div class="test-grid" id="testGrid">
            <!-- Test cards will be generated here -->
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="runAllTests()">Run All Tests</button>
            <button class="btn" onclick="startMonitoring()">Start FPS Monitoring</button>
            <button class="btn" onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="monitoringResults" class="results" style="display: none;">
            <h3>Real-time Performance Monitoring</h3>
            <div class="metric">
                <span>FPS:</span>
                <span id="fpsDisplay">--</span>
            </div>
            <div class="metric">
                <span>Memory Usage:</span>
                <span id="memoryDisplay">--</span>
            </div>
            <div class="metric">
                <span>DOM Nodes:</span>
                <span id="domNodesDisplay">--</span>
            </div>
        </div>
    </div>

    <script>
        // Performance test definitions
        const performanceTests = [
            {
                name: 'Small Dataset Rendering',
                description: 'Test rendering 50 department cards',
                dataSize: 50,
                expectedTime: 50
            },
            {
                name: 'Medium Dataset Rendering',
                description: 'Test rendering 200 department cards',
                dataSize: 200,
                expectedTime: 100
            },
            {
                name: 'Large Dataset Rendering',
                description: 'Test rendering 500 department cards',
                dataSize: 500,
                expectedTime: 200
            },
            {
                name: 'Bed Matrix Performance',
                description: 'Test bed matrix with 20 wards, 30 beds each',
                dataSize: 600,
                expectedTime: 150
            },
            {
                name: 'Search Performance',
                description: 'Test search filtering on 1000 items',
                dataSize: 1000,
                expectedTime: 30
            },
            {
                name: 'Pagination Performance',
                description: 'Test pagination with 2000 items',
                dataSize: 2000,
                expectedTime: 20
            }
        ];

        // Generate test data
        function generateTestData(size) {
            const data = [];
            for (let i = 1; i <= size; i++) {
                data.push({
                    id: i,
                    name: `Department ${i}`,
                    code: `D${i.toString().padStart(3, '0')}`,
                    status: i % 10 === 0 ? 'inactive' : 'active',
                    description: `Test department ${i} with some description text`,
                    wards_count: Math.floor(Math.random() * 5) + 1,
                    test_catalogs_count: Math.floor(Math.random() * 20) + 5
                });
            }
            return data;
        }

        // Render test cards
        function renderTestCards(data, containerId) {
            const container = document.getElementById(containerId);
            const startTime = performance.now();
            
            container.innerHTML = '';
            
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'test-card';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <strong>${item.name}</strong>
                        <span style="background: ${item.status === 'active' ? '#10b981' : '#6b7280'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">
                            ${item.status}
                        </span>
                    </div>
                    <div style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">
                        Code: ${item.code}
                    </div>
                    <div style="color: #6b7280; font-size: 12px;">
                        ${item.wards_count} wards • ${item.test_catalogs_count} tests
                    </div>
                `;
                container.appendChild(card);
            });
            
            const endTime = performance.now();
            return endTime - startTime;
        }

        // Run individual test
        async function runTest(test, index) {
            const testCard = document.querySelector(`[data-test-index="${index}"]`);
            const resultsDiv = testCard.querySelector('.results');
            const progressBar = testCard.querySelector('.progress-bar');
            
            testCard.classList.add('active');
            progressBar.style.width = '0%';
            
            try {
                // Generate test data
                progressBar.style.width = '20%';
                const data = generateTestData(test.dataSize);
                
                // Create temporary container for rendering test
                progressBar.style.width = '40%';
                const tempContainer = document.createElement('div');
                tempContainer.id = `test-container-${index}`;
                tempContainer.style.position = 'absolute';
                tempContainer.style.left = '-9999px';
                tempContainer.style.display = 'grid';
                tempContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(250px, 1fr))';
                tempContainer.style.gap = '16px';
                document.body.appendChild(tempContainer);
                
                // Measure memory before
                const memoryBefore = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                // Run rendering test
                progressBar.style.width = '70%';
                const renderTime = renderTestCards(data, tempContainer.id);
                
                // Measure memory after
                const memoryAfter = performance.memory ? performance.memory.usedJSHeapSize : 0;
                const memoryUsed = (memoryAfter - memoryBefore) / 1024 / 1024; // MB
                
                progressBar.style.width = '90%';
                
                // Clean up
                document.body.removeChild(tempContainer);
                
                progressBar.style.width = '100%';
                
                // Display results
                const isGood = renderTime <= test.expectedTime;
                const isWarning = renderTime <= test.expectedTime * 1.5;
                const resultClass = isGood ? 'good' : (isWarning ? 'warning' : 'bad');
                
                resultsDiv.innerHTML = `
                    <div class="metric ${resultClass}">
                        <span>Render Time:</span>
                        <span>${renderTime.toFixed(2)}ms</span>
                    </div>
                    <div class="metric">
                        <span>Expected:</span>
                        <span>${test.expectedTime}ms</span>
                    </div>
                    <div class="metric">
                        <span>Memory Used:</span>
                        <span>${memoryUsed.toFixed(2)}MB</span>
                    </div>
                    <div class="metric">
                        <span>Items Rendered:</span>
                        <span>${test.dataSize}</span>
                    </div>
                    <div class="metric">
                        <span>Performance:</span>
                        <span>${isGood ? '✅ Good' : (isWarning ? '⚠️ Warning' : '❌ Poor')}</span>
                    </div>
                `;
                
                return {
                    test: test.name,
                    renderTime,
                    memoryUsed,
                    dataSize: test.dataSize,
                    performance: isGood ? 'good' : (isWarning ? 'warning' : 'poor')
                };
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="metric bad"><span>Error:</span><span>${error.message}</span></div>`;
                return null;
            } finally {
                testCard.classList.remove('active');
            }
        }

        // Run all tests
        async function runAllTests() {
            const results = [];
            
            for (let i = 0; i < performanceTests.length; i++) {
                const result = await runTest(performanceTests[i], i);
                if (result) results.push(result);
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // Show summary
            console.log('Performance Test Results:', results);
            
            const avgRenderTime = results.reduce((sum, r) => sum + r.renderTime, 0) / results.length;
            const avgMemoryUsage = results.reduce((sum, r) => sum + r.memoryUsed, 0) / results.length;
            
            alert(`Tests completed!\nAverage render time: ${avgRenderTime.toFixed(2)}ms\nAverage memory usage: ${avgMemoryUsage.toFixed(2)}MB`);
        }

        // FPS monitoring
        let monitoringActive = false;
        let frameCount = 0;
        let lastTime = performance.now();

        function startMonitoring() {
            if (monitoringActive) return;
            
            monitoringActive = true;
            document.getElementById('monitoringResults').style.display = 'block';
            
            function monitor() {
                if (!monitoringActive) return;
                
                frameCount++;
                const currentTime = performance.now();
                
                if (currentTime - lastTime >= 1000) {
                    const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                    const memory = performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) : 'N/A';
                    const domNodes = document.querySelectorAll('*').length;
                    
                    document.getElementById('fpsDisplay').textContent = fps + ' fps';
                    document.getElementById('memoryDisplay').textContent = memory + ' MB';
                    document.getElementById('domNodesDisplay').textContent = domNodes;
                    
                    // Color code FPS
                    const fpsElement = document.getElementById('fpsDisplay').parentElement;
                    fpsElement.className = 'metric ' + (fps >= 50 ? 'good' : (fps >= 30 ? 'warning' : 'bad'));
                    
                    frameCount = 0;
                    lastTime = currentTime;
                }
                
                requestAnimationFrame(monitor);
            }
            
            requestAnimationFrame(monitor);
        }

        function stopMonitoring() {
            monitoringActive = false;
            document.getElementById('monitoringResults').style.display = 'none';
        }

        function clearResults() {
            document.querySelectorAll('.results').forEach(div => {
                div.innerHTML = '<em>Click "Run Test" to see results</em>';
            });
            stopMonitoring();
        }

        // Initialize test grid
        function initializeTestGrid() {
            const grid = document.getElementById('testGrid');
            
            performanceTests.forEach((test, index) => {
                const testCard = document.createElement('div');
                testCard.className = 'test-card';
                testCard.setAttribute('data-test-index', index);
                
                testCard.innerHTML = `
                    <h3>${test.name}</h3>
                    <p>${test.description}</p>
                    <div class="progress">
                        <div class="progress-bar" style="width: 0%;"></div>
                    </div>
                    <button class="btn" onclick="runTest(performanceTests[${index}], ${index})">
                        Run Test
                    </button>
                    <div class="results">
                        <em>Click "Run Test" to see results</em>
                    </div>
                `;
                
                grid.appendChild(testCard);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeTestGrid);
    </script>
</body>
</html>